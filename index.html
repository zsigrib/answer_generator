<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript">

		const queryString = window.location.search;//"Website=CrawlImmoscout&Timestamp=2023-06-06+23%3A48%3A13.776813&Title=None&Bezirk=Tempelhof-Schöneberg&Ortsteil=Schöneberg&PLZ=12159&Street=Wielandstraße&Address=Wielandstrasse+4+12159+Berlin&Longitude=13.3389576&Latitude=52.4736649&Kaltmiete=None&Warmmiete=None&Nebenkosten=None&Rooms=None&Bedrooms=None&Bathrooms=None&m2=None&Type=None&Heating+costs=None&House+number=4&Floor+number=None&FU+distance=1940.978319308088&HU+distance=3219.7368421052633&TU+distance=2323.4333606741934&Closest+Bahnhof=Friedenau&Closest+supermarket=LPG+BioMarkt&Closest+tram=Lüneburger+Straße&Heating+type=None&Heating+source=None&Distance+to+Bahnhof=580.15&Distance+to+supermarket=328.48&Distance+to+tram=6335.51&Move+in+from=None"//
		console.log(queryString);
		// example query string:  ?product=shirt&color=blue&newuser&size=m
		const urlParams = new URLSearchParams(queryString)
		//Get params via: urlParams.get('challenge')
		// Setup
		// TODO: disable nonsensical buttons

		
		function copyToClipboard(text) {
		    var dummy = document.createElement("textarea");
		    // to avoid breaking orgain page when copying more words
		    // cant copy when adding below this code
		    // dummy.style.display = 'none'
		    document.body.appendChild(dummy);
		    //Be careful if you use texarea. setAttribute('value', value), which works with "input" does not work with "textarea". – Eduard
		    dummy.value = text;
		    dummy.select();
		    document.execCommand("copy");
		    document.body.removeChild(dummy);
		}
		

		function toClipboard(){
			// Select the text field & copy to clipboard:
			var editorElem = document.getElementById("editor");
			copyToClipboard(editorElem.innerText)
		}

		function germanText(form){
			// Produce message:
			var messageString = `Sehr geehrte ${form.recipient.value},\n\n`+
			`Wir suchen ein Zuhause als Stipendiaten in einem gemeinsamen `+
			`Promotionsprogramm (der dauert mindestens 5 Jahre) und würden `+
			`wahrscheinlich auch danach gerne bleiben. Aus diesem Grund hat `+
			`uns Ihre Anzeige`

			if (form.reference.value == 'Address'){
				messageString = messageString + ` für die Wohnung in ${form.address.value}`
			} else if (form.reference.value == 'Number of rooms') {
				messageString = messageString + ` für die ${form.rooms.value}-Zimmer-Wohnung`
			} else if (form.reference.value == 'Title'){
				messageString = messageString + ` mit dem Titel "${form.title.value}"`
			}

			if (form.refweb.value == 'Yes'){
				messageString = messageString + ` auf ${form.website.value}`
			}

			messageString = messageString + " aufmerksam gemacht."

			if (form.blueprint.value == 'Yes'){
				messageString = messageString + " Wenn möglich, würden wir uns für den Grundriss interessieren."
			}

			messageString = messageString +"\n\nUnsere im Wesentlichen bedingungslosen "+
			"Verträge bieten ein sicheres Einkommen. Wir sind Nichtraucher, haustierfrei, "+
			"ruhig und introvertiert. Darüber hinaus spezialisieren wir uns alle drei auf "+
			"Mathematik, so dass wir viel studieren, und deshalb suchen wir ein Zuhause, "+
			"wo wir dies in Ruhe tun können."

			if (form.calm.value == 'Yes'){
				messageString = messageString + " Ihres Stadtviertel scheint die dafür notwendige ruhige Umgebung zu bieten."
			} else {
				messageString = messageString + " Wir hoffen, dass Ihre Wohnung die dafür notwendige ruhige Umgebung bietet."
			}

			messageString = messageString + " Besonders attraktiv finden wir "
			
			if (form.closest.value == "All"){
				messageString = messageString + "die Nähe zu den drei großen Universitäten, die wir besuchen"
			} else if (form.closest.value == "FU"){
				messageString = messageString + "die Nähe zur Freie Universität"
			} else if (form.closest.value == "TU"){
				messageString = messageString + "die Nähe zur Technische Universität"
			} else if (form.closest.value == "HU"){
				messageString = messageString + "die Nähe zur Humboldt Universität"
			}

			var goodies = [];
			if (form.balcony.checked){
				goodies.push("den Balkon")
			}
			if (form.balconies.checked){
				goodies.push("die Balkone")
			}
			if (form.washingmachine.checked){
				goodies.push("die Waschmaschine")
			}
			if (form.ebk.checked){
				goodies.push("die Einbauküche")
			}
			for (let i = 0; i < goodies.length; i++) {
				messageString = messageString + ", "
				if (i == goodies.length - 1){
					messageString = messageString + "und "
				}
				messageString = messageString + goodies[i]
			}

			messageString = messageString + ".\n\n"+
			"Die jahrzehntelange Freundschaft "+
			"zwischen uns bedeutet, dass wir uns gegenseitig vertrauen, einen "+
			"konventionell hohen Standard an Ordnung und Sauberkeit aufrechtzuerhalten, "+
			"den wir uns nach unseren Erfahrungen mit Wohngemeinschaften mit anderen "+
			"sehr wünschen."+
			"\n\n"+
			"Schließlich sind wir nach den letzten Jahren in Berlin "+
			"überzeugt, dass wir alles auf Deutsch regeln können. Künftig soll jedoch "+
			"die Kommunikation auf Englisch bevorzugt werden."+
			"\n\n"+
			"Mit freundlichen Grüßen,\n"+
			"Adam Schweitzer"

			// Add message to editor:
			document.getElementById("editor").innerText = messageString;
			toClipboard()
		}

		function englishText(form){
			// Produce message:
			var messageString = `Dear ${form.recipient.value},\n\n`+
			`We are looking for a home as scholarship holders in a joint `+
			`PhD program lasting at least 5 years, and would likely prefer `+
			`to stay afterwards as well. Hence your advertisement`

			if (form.reference.value == 'Address'){
				messageString = messageString + ` for the apartment in ${form.address.value}`
			} else if (form.reference.value == 'Number of rooms') {
				messageString = messageString + ` for the ${form.rooms.value}-room apartment`
			} else if (form.reference.value == 'Title'){
				messageString = messageString + ` titled "${form.title.value}"`
			}

			if (form.refweb.value == 'Yes'){
				messageString = messageString + ` on ${form.website.value}`
			}

			messageString = messageString + " has caught our attention."

			if (form.blueprint.value == 'Yes'){
				messageString = messageString + " If possible, we would be interested in seeing the floorplan of the apartment."
			}

			messageString = messageString +"\n\nOur essentially unconditional "+
			"contracts provide a stable source of income. We are non-smokers, "+
			"pet free, calm, and introverted. Moreover, all three of us specialize "+
			"in mathematics so we study a lot, and we consequently seek a home "+
			"where we can do so in peace."

			if (form.calm.value == 'Yes'){
				messageString = messageString + " Your neighborhood seems to provide the calm environment necessary for that."
			} else {
				messageString = messageString + " We hope your apartment can provide the calm environment necessary for that."
			}

			messageString = messageString + " We especially find "

			if (form.closest.value == "All"){
				messageString = messageString + "the proximity of the three major universities that we attend"
			} else if (form.closest.value == "FU"){
				messageString = messageString + "the proximity of Freie Universität"
			} else if (form.closest.value == "TU"){
				messageString = messageString + "the proximity of Technische Universität"
			} else if (form.closest.value == "HU"){
				messageString = messageString + "the proximity of Humboldt Universität"
			}

			var goodies = [];
			if (form.balcony.checked){
				goodies.push("the balcony")
			}
			if (form.balconies.checked){
				goodies.push("the balconies")
			}
			if (form.washingmachine.checked){
				goodies.push("the washing machine")
			}
			if (form.ebk.checked){
				goodies.push("the fitted kitchen")
			}
			for (let i = 0; i < goodies.length; i++) {
				messageString = messageString + ", "
				if (i == goodies.length - 1){
					messageString = messageString + "and "
				}
				messageString = messageString + goodies[i]
			}

			messageString = messageString + " attractive.\n\n"+
			"The decade old friendship between us means that we trust "+
			"each other to maintain a conventionally high standard of "+
			"order and cleanliness, which we highly desire after our "+
			"experiences with shared accommodations with others."+
			"\n\n"+
			"Finally, after our past years in Berlin we are convinced "+
			"that we can get everything sorted out in German. However, "+
			"in the future communication in English would be preferred."+
			"\n\n"+
			"Yours sincerely,\n"+
			"Adam Schweitzer"

			// Add message to editor:
			document.getElementById("editor").innerText = messageString;
			toClipboard()
		}

		function selectItem(item) {
			item.addClass('selected');
			item.siblings().removeClass('selected');
			$(`#${item.parent().attr("data-storage")}`).val(item.text());
		}

		function OnLoad(e) {
			// Make list items selectable
			$('ul.select li').click(function(e){
                var item = $(e.target);
                selectItem(item);
            });
			// Calculate textbox default values
		    document.getElementById("title").value = urlParams.get('Title');
			document.getElementById("website").value = urlParams.get('Website').substring(5);
			if (urlParams.get("Street") != "None") {
				document.getElementById("address").value = urlParams.get("Street")
				selectItem($(document.getElementById("opt-address")))
				if (urlParams.get("House number") != "None") {
					document.getElementById("address").value += " " + urlParams.get("House number")
				}
			} else if (urlParams.get('Address') != "None") {
				document.getElementById("address").value = urlParams.get('Address')
			} else {
				document.getElementById("address").value = ""
			}

			var rms = urlParams.get("Rooms")
			if (rms == "None") {
				document.getElementById("rooms").value = ""
			} else if (rms.endsWith(".0")) {
				document.getElementById("rooms").value = rms.substring(0, rms.length-2)
			} else {
				document.getElementById("rooms").value = rms
			}
			// Select default values
			var tu = ((urlParams.get("TU distance") == "None") ? 2*60*60 : urlParams.get("TU distance"))
			var hu = ((urlParams.get("HU distance") == "None") ? 2*60*60 : urlParams.get("HU distance"))
			var fu = ((urlParams.get("FU distance") == "None") ? 2*60*60 : urlParams.get("FU distance"))
			console.log("rshgerh")
			if (fu < 40*60 && hu >= 40*60 && tu >= 40*60) {
				selectItem($(document.getElementById("opt-fu")))
			} else if (fu >= 40*60 && hu < 40*60 && tu >= 40*60) {
				selectItem($(document.getElementById("opt-hu")))
			} else if (fu >= 40*60 && hu >= 40*60 && tu < 40*60) {
				selectItem($(document.getElementById("opt-tu")))
			}
			$('ul.select li.selected').each(function(idx){selectItem($(this));});
		}
		window.onload = OnLoad
	</script>
	<style>
		.textarea {
			border: 1px solid #ccc;
			padding: 1px 6px;
			display: block;
			width: 100%;
			overflow: hidden;
			resize: both;
			min-height: 40px;
			line-height: 20px;
		}
		ul.select {
			display: flex;
			flex-direction: row;
			list-style: none;
			margin:  0;
			padding: 0px;
		}

		ul.select li {
			display: flex;
			flex-grow: 1;
			justify-content: center;
			text-align:center;
			border-width: 2px;
			border-radius: 5px;
			border-style: solid;
			border-color: #ccc;
			margin: 2px;
			padding: 2px 6px;
		}
		ul.select li:hover {
			cursor: pointer;
		}
		ul.select li.selected {
			background-color: blue;
			color: white;
		}
		div.btns {
			display: flex;
			flex-direction: row;
		}
		div.btns input[type="button"]{
			display: flex;
			flex-grow: 1;
			justify-content: center;
			text-align: center;
			margin: 2px;
			padding: 2px 6px;
			border-width: 2px;
			border-radius: 5px;
			border-style: solid;
			border-color: #ccc;
			font-size: 16px;
		}
		input[type="text"] {
			width: 100%;
			border-width: 2px;
			border-style: solid;
			border-color: #ccc;
		}
		input[type="checkbox"] {
			width: 20px;
        	height: 20px;
			margin: 5px 2px;
		}
		label {
			font-size: 16px;
		}
	</style>
</head>
<body>
	<form name="data" action="" method="GET">
		<b>Recipient:</b><br>
		<input type="text" id="recipient" value="Damen und Herren"><br>
		<b>Title:</b><br>
		<input type="text" id="title" value="[MISSING]"><br>
		<b>Website:</b><br>
		<input type="text" id="website" value="[MISSING]"><br>
		<b>Address:</b><br>
		<input type="text" id="address" value="[MISSING]"><br>
		<b>Number of rooms:</b><br>
		<input type="text" id="rooms" value=""><br><br>
		<b>Reference:</b><br>
		<input id="reference" type="hidden" name="reference">
		<ul class="select" data-storage="reference">
			<li id="opt-address">Address</li>
			<li id="opt-zimmer">Number of rooms</li>
			<li id="opt-title">Title</li>
			<li class="selected">[Skip]</li>
		</ul>
		<b>Reference website?</b><br>
		<input id="refweb" type="hidden" name="refweb">
		<ul class="select" data-storage="refweb">
			<li>Yes</li>
			<li class="selected">No</li>
		</ul>
		<b>Ask for blueprint?</b><br>
		<input id="blueprint" type="hidden" name="blueprint">
		<ul class="select" data-storage="blueprint">
			<li>Yes</li>
			<li class="selected">No</li>
		</ul>
		<b>Is neighborhood calm?</b><br>
		<input id="calm" type="hidden" name="calm">
		<ul class="select" data-storage="calm">
			<li>Yes</li>
			<li class="selected">No</li>
		</ul>
		<b>Close to?</b><br>
		<input id="closest" type="hidden" name="closest">
		<ul class="select" data-storage="closest">
			<li class="selected">All</li>
			<li id="opt-fu">FU</li>
			<li id="opt-tu">TU</li>
			<li id="opt-hu">HU</li>
		</ul>
		<b>What do we like?</b><br>
		<input type="checkbox" id="balcony" name="balcony">
		<label for="balcony">the balcon<b>y</b></label><br>
		<input type="checkbox" id="balconies" name="balconies">
		<label for="balconies">the balcon<b>ies</b></label><br>
		<input type="checkbox" id="washingmachine" name="washingmachine">
		<label for="washingmachine">the washing machine</label><br>
		<input type="checkbox" id="ebk" name="ebk" checked>
		<label for="ebk">the fitted kitchen</label><br>

		<div class="btns">
			<input type="button" name="german" value="German" onClick="germanText(this.form)">
			<input type="button" name="english" value="English" onClick="englishText(this.form)">
			<input type="button" name="clear" value="Clear textbox" onClick="document.getElementById('editor').innerText=''">
		</div>
	</form><br><br>
	
	<span class="textarea" id="editor" role="textbox" contenteditable>[DUMMY TEXT]</span>
	<br><br>
	<div class="btns">
		<input type="button" name="copyAndExit" value="Copy & Exit" onClick="toClipboard();window.close()">
		<input type="button" name="exit" value="Just Exit" onClick="window.close()">
	</div>
</body>
